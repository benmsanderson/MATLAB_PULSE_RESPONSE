

br=NaN(2,numel(mdls));
bsln_t=NaN(numel(mdls),100);
tcr2_crnd=NaN(numel(mdls),100);
clear usernd
n=0
for i=1:numel(mdls)
if and(and(isfield(ens.(mdls{i}),'piControl'),isfield(ens.(mdls{i}),'onepctCO2')),isfield(ens.(mdls{i}),'abrupt4xCO2'))
if isfield(ens.(mdls{i}).piControl,'rsut')
if and(isfield(ens.(mdls{i}).onepctCO2,'rlut'),isfield(ens.(mdls{i}).onepctCO2,'rsut'))
  if numel(ens.(mdls{i}).piControl.rlut{1})==numel(ens.(mdls{i}).piControl.rsut{1})
    if numel(ens.(mdls{i}).abrupt4xCO2.tas{1})>100
n=n+1;
nt=numel(ens.(mdls{i}).piControl.tas{1});
for j=1:100
ts=ceil(rand*(nt-51));
bsln_t(i,j)=mean(ens.(mdls{i}).piControl.tas{1}(ts:ts+50));
bsln_rl(i,j)=mean(ens.(mdls{i}).piControl.rlut{1}(ts:ts+50));
bsln_rs(i,j)=mean(ens.(mdls{i}).piControl.rsut{1}(ts:ts+50));

tcr2_crnd(i,j)=mean(ens.(mdls{i}).onepctCO2.tas{1}(61:80))-bsln_t(i,j);
	a=((ens.(mdls{i}).abrupt4xCO2.tas{1}-bsln_t(i,j)));
	rs=((ens.(mdls{i}).abrupt4xCO2.rsut{1}-bsln_rl(i,j)));
	rl=((ens.(mdls{i}).abrupt4xCO2.rlut{1}-bsln_rs(i,j)));
	b=regress([a],[-rs-rl,ones(size(a))]);

	sens_arnd(i,j)=b(2)/2;
	usernd(n)=i;
	end
end
end
end
end
end
end


figure(3)
subplot(2,1,1)
boxplot(sens_arnd(usernd,:)')
set(gca,'xticklabel',repmat('',1,numel(usernd)))
ax1=gca;
grid on
ylabel('ECS (K)')
title({'Sensitivity of ECS and TCR to','choice of control baseline period'})
subplot(2,1,2)
boxplot(tcr2_crnd(usernd,:)')
set(gca,'xticklabel',mdls(usernd),'XTickLabelRotation',90)
grid on
ax2=gca;
ylabel('TCR (K)')

set(ax1,'position',[0.1,0.6,0.8,0.3])
set(ax2,'position',[0.1,0.3,0.8,0.3])

   set(gcf, 'PaperPosition', [0 0 7 6]);
set(gcf, 'PaperSize', [7 6]); 
print(gcf,'-dpdf','-painters',['tbox.pdf']);

